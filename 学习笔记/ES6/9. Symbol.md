#Symbol

[TOC]

##??

ES5????????????????????????????????????????????????????????mixin???????????????????????????????????????????????????????????????????????ES6??Symbol????

ES6?????????????Symbol????????????JavaScript????????????????Undefined?Null?????Boolean??????String?????Number?????Object??

Symbol???`Symbol`??????????????????????????????????????????????Symbol??????????Symbol?????????????????????????????

```javascript
let s = Symbol();

typeof s
// "symbol"
```

????????`s`???????????`typeof`???????????`s`?Symbol???????????????????

????????`s`???????????`typeof`???????????`s`?Symbol???????????????????

???`Symbol`???????`new`????????????????Symbol??????????????????????Symbol???????????????????????????????????

`Symbol`???????????????????Symbol??????????????????????????????????

```javascript
var s1 = Symbol('foo');
var s2 = Symbol('bar');

s1 // Symbol(foo)
s2 // Symbol(bar)

s1.toString() // "Symbol(foo)"
s2.toString() // "Symbol(bar)"
```

???`Symbol`????????????Symbol????????????`Symbol`????????????

```javascript
// ???????
var s1 = Symbol();
var s2 = Symbol();

s1 === s2 // false

// ??????
var s1 = Symbol("foo");
var s2 = Symbol("foo");

s1 === s2 // false
// ??????s1?s2??Symbol????????????????????????
```

Symbol???????????????????

```javascript
var sym = Symbol('My symbol');

// "your symbol is " + sym
// TypeError: can't convert symbol to string
// `your symbol is ${sym}`
// TypeError: can't convert symbol to string
```

???Symbol???????????

```javascript
var sym = Symbol('My symbol');

String(sym) // 'Symbol(My symbol)'
sym.toString() // 'Symbol(My symbol)'
```

???Symbol???????????????????

```javascript
var sym = Symbol();
Boolean(sym) // true
!sym  // false

if (sym) {
  // ...
}

Number(sym) // TypeError
sym + 2 // TypeError
```



##??????Symbol

?????Symbol????????????Symbol???????????????????????????????????????????????????????????????????????

```javascript
var mySymbol = Symbol();

// ?????
var a = {};
a[mySymbol] = 'Hello!';

// ?????
var a = {
  [mySymbol]: 'Hello!'
};

// ?????
var a = {};
Object.defineProperty(a, mySymbol, { value: 'Hello!' });

// ???????????
a[mySymbol] // "Hello!"

// ????????????Object.defineProperty?????????????Symbol??
```

***???Symbol??????????????????***

```javascript
var mySymbol = Symbol();
var a = {};

a.mySymbol = 'Hello!';
a[mySymbol] // undefined
a['mySymbol'] // "Hello!"

// ??????????????????????????mySymbol???????????????a???????????????????Symbol??
```

????????????Symbol???????Symbol???????????

```javascript
let s = Symbol();

let obj = {
  [s]: function (arg) { ... }
};

obj[s](123);
  
// ????????s???????????????????s????s??????Symbol??
```

???????????????`obj`????????????

```javascript
let obj = {
  [s](arg) { ... }
};
```

Symbol?????????????????????????????

```javascript
log.levels = {
  DEBUG: Symbol('debug'),
  INFO: Symbol('info'),
  WARN: Symbol('warn'),
};
log(log.levels.DEBUG, 'debug message');
log(log.levels.INFO, 'info message');
```

??????????

```javascript
const COLOR_RED    = Symbol();
const COLOR_GREEN  = Symbol();

function getComplement(color) {
  switch (color) {
    case COLOR_RED:
      return COLOR_GREEN;
    case COLOR_GREEN:
      return COLOR_RED;
    default:
      throw new Error('Undefined color');
    }
}
```

????Symbol??????????????????????????????????`switch`????????????

?????????Symbol?????????????**????**????????



##??????????

**?????**?????????????????????????????????????????????????????????????????????

```javascript
function getArea(shape, options) {
  var area = 0;

  switch (shape) {
    case 'Triangle': // ?????
      area = .5 * options.width * options.height;
      break;
    /* ... more code ... */
  }

  return area;
}

getArea('Triangle', { width: 100, height: 100 }); // ?????

// ??????????Triangle????????????????????????????????????????
```

?????????????????????????

```javascript
var shapeType = {
  triangle: 'Triangle'
};

function getArea(shape, options) {
  var area = 0;
  switch (shape) {
    case shapeType.triangle:
      area = .5 * options.width * options.height;
      break;
  }
  return area;
}

getArea(shapeType.triangle, { width: 100, height: 100 });

// ??????????Triangle???shapeType???triangle?????????????
```

???????????`shapeType.triangle`???????????????????`shapeType`????????????????????Symbol??

```javascript
const shapeType = {
  triangle: Symbol()
};

// ?????????shapeType.triangle??????Symbol???????????
```



##??????

Symbol??????????????`for...in`?`for...of`????????`Object.keys()`?`Object.getOwnPropertyNames()`??????????????????`Object.getOwnPropertySymbols`??????????????Symbol????

`Object.getOwnPropertySymbols`?????????????????????????Symbol??

```javascript
var obj = {};
var a = Symbol('a');
var b = Symbol.for('b');

obj[a] = 'Hello';
obj[b] = 'World';

var objectSymbols = Object.getOwnPropertySymbols(obj);

objectSymbols
// [Symbol(a), Symbol(b)]
```

?????????`Object.getOwnPropertySymbols`???`for...in`???`Object.getOwnPropertyNames`??????????

```javascript
var obj = {};

var foo = Symbol("foo");

Object.defineProperty(obj, foo, {
  value: "foobar",
});

for (var i in obj) {
  console.log(i); // ???
}

Object.getOwnPropertyNames(obj)
// []

Object.getOwnPropertySymbols(obj)
// [Symbol(foo)]

// ????????Object.getOwnPropertyNames?????Symbol????????Object.getOwnPropertySymbols???
```

?????API?`Reflect.ownKeys`?????????????????????Symbol???

```javascript
let obj = {
  [Symbol('my_key')]: 1,
  enum: 2,
  nonEnum: 3
};

Reflect.ownKeys(obj)
// [Symbol(my_key), 'enum', 'nonEnum']
```

???Symbol?????????????????????????????????????????????????????????

```javascript
var size = Symbol('size');

class Collection {
  constructor() {
    this[size] = 0;
  }

  add(item) {
    this[this[size]] = item;
    this[size]++;
  }

  static sizeOf(instance) {
    return instance[size];
  }
}

var x = new Collection();
Collection.sizeOf(x) // 0

x.add('foo');
Collection.sizeOf(x) // 1

Object.keys(x) // ['0']
Object.getOwnPropertyNames(x) // ['0']
Object.getOwnPropertySymbols(x) // [Symbol(size)]

// ????????x?size?????Symbol????Object.keys(x)?Object.getOwnPropertyNames(x)??????????????????????????
```



##Symbol.for(), Symbol.keyFor()

??????????????Symbol??`Symbol.for`???????????????????????????????????????Symbol???????????Symbol?????????????????????Symbol??

```javascript
var s1 = Symbol.for('foo');
var s2 = Symbol.for('foo');

s1 === s2 // true

// ??????s1?s2??Symbol?????????????Symbol.for?????????????????
```

`Symbol.for()`?`Symbol()`????????????Symbol?????????????????????????????`Symbol.for()`?????????????Symbol??????????????key????????????????????????????`Symbol.for("cat")`30???????????Symbol??????`Symbol("cat")`30?????30????Symbol??

```javascript
Symbol.for("bar") === Symbol.for("bar")
// true

Symbol("bar") === Symbol("bar")
// false

// ????????Symbol()??????????????????????????
```

Symbol.keyFor??????????Symbol????key?

```javascript
var s1 = Symbol.for("foo");
Symbol.keyFor(s1) // "foo"

var s2 = Symbol("foo");
Symbol.keyFor(s2) // undefined

// ????????s2??????Symbol??????undefined?
```

???????`Symbol.for`?Symbol????????????????????iframe?service worker????????

```javascript
iframe = document.createElement('iframe');
iframe.src = String(window.location);
document.body.appendChild(iframe);

iframe.contentWindow.Symbol.for('foo') === Symbol.for('foo')
// true

// ??????iframe?????Symbol???????????
```



##???Symbol?

?????????Symbol????ES6????11????Symbol??????????????

**Symbol.hasInstance**

???`Symbol.hasInstance`???????????????????`instanceof`????????????????????????????`foo instanceof Foo`????????????`Foo[Symbol.hasInstance](foo)`?

```javascript
class MyClass {
  [Symbol.hasInstance](foo) {
    return foo instanceof Array;
  }
}

[1, 2, 3] instanceof MyClass() // true
```

**Symbol.isConcatSpreadable**

???`Symbol.isConcatSpreadable`?????????????????`Array.prototype.concat()`?????????

```javascript
let arr1 = ['c', 'd'];
['a', 'b'].concat(arr1, 'e') // ['a', 'b', 'c', 'd', 'e']

let arr2 = ['c', 'd'];
arr2[Symbol.isConcatSpreadable] = false;
['a', 'b'].concat(arr2, 'e') // ['a', 'b', ['c','d'], 'e']

// ??????????Symbol.isConcatSpreadable?????true????????
```

????????????????`Symbol.isConcatSpreadable`?????`false`????????

```javascript
let obj = {length: 2, 0: 'c', 1: 'd'};
['a', 'b'].concat(obj, 'e') // ['a', 'b', obj, 'e']

obj[Symbol.isConcatSpreadable] = true;
['a', 'b'].concat(obj, 'e') // ['a', 'b', 'c', 'd', 'e']
```

????????`Symbol.isConcatSpreadable`?????????????????

```javascript
class A1 extends Array {
  [Symbol.isConcatSpreadable]() {
    return true;
  }
}
class A2 extends Array {
  [Symbol.isConcatSpreadable]() {
    return false;
  }
}
let a1 = new A1();
a1[0] = 3;
a1[1] = 4;
let a2 = new A2();
a2[0] = 5;
a2[1] = 6;
[1, 2].concat(a1).concat(a2)
// [1, 2, 3, 4, [5, 6]]

// ???????A1???????A2???????????concat?????????
```

**Symbol.species**

???`Symbol.species`????????????????????????????????????`this.constructor[Symbol.species]`????????????????????????????

`Symbol.species`???????????

```javascript
static get [Symbol.species]() {
  return this;
}
```

**Symbol.match**

???`Symbol.match`?????????????`str.match(myObject)`?????????????????????????

```javascript
String.prototype.match(regexp)
// ???
regexp[Symbol.match](this)

class MyMatcher {
  [Symbol.match](string) {
    return 'hello world'.indexOf(string);
  }
}

'e'.match(new MyMatcher()) // 1
```

**Symbol.replace**

???`Symbol.replace`???????????????`String.prototype.replace`?????????????????

```javascript
String.prototype.replace(searchValue, replaceValue)
// ???
searchValue[Symbol.replace](this, replaceValue)
```

**Symbol.search**

???`Symbol.search`???????????????`String.prototype.search`?????????????????

```javascript
String.prototype.search(regexp)
// ???
regexp[Symbol.search](this)

class MySearch {
  constructor(value) {
    this.value = value;
  }
  [Symbol.search](string) {
    return string.indexOf(this.value);
  }
}
'foobar'.search(new MySearch('foo')) // 0
```

**Symbol.split**

???`Symbol.split`???????????????`String.prototype.split`?????????????????

```javascript
String.prototype.split(separator, limit)
// ???
separator[Symbol.split](this, limit)
```

**Symbol.iterator**

???Symbol.iterator???????????????????????for...of???????????????????????????????Iterator?for...of??????

```javascript
class Collection {
  *[Symbol.iterator]() {
    let i = 0;
    while(this[i] !== undefined) {
      yield this[i];
      ++i;
    }
  }
}

let myCollection = new Collection();
myCollection[0] = 1;
myCollection[1] = 2;

for(let value of myCollection) {
  console.log(value);
}
// 1
// 2
```

**Symbol.toPrimitive**

???`Symbol.toPrimitive`??????????????????????????????????????????????

`Symbol.toPrimitive`??????????????????????????????????

- Number??????????
- String???????????
- Default???????????????????

```javascript
let obj = {
  [Symbol.toPrimitive](hint) {
    switch (hint) {
      case 'number':
        return 123;
      case 'string':
        return 'str';
      case 'default':
        return 'default';
      default:
        throw new Error();
     }
   }
};

2 * obj // 246
3 + obj // '3default'
obj === 'default' // true
String(obj) // 'str
```

**Symbol.toStringTag**

???`Symbol.toStringTag`??????????????????`Object.prototype.toString`??????????????????????`toString`??????????????????????????????????`[object Object]`?`[object Array]`?object?????????

```javascript
({[Symbol.toStringTag]: 'Foo'}.toString())
// "[object Foo]"

class Collection {
  get [Symbol.toStringTag]() {
    return 'xxx';
  }
}
var x = new Collection();
Object.prototype.toString.call(x) // "[object xxx]"
```

ES6???????`Symbol.toStringTag`??????

- `JSON[Symbol.toStringTag]`?'JSON'
- `Math[Symbol.toStringTag]`?'Math'
- Module??`M[Symbol.toStringTag]`?'Module'
- `ArrayBuffer.prototype[Symbol.toStringTag]`?'ArrayBuffer'
- `DataView.prototype[Symbol.toStringTag]`?'DataView'
- `Map.prototype[Symbol.toStringTag]`?'Map'
- `Promise.prototype[Symbol.toStringTag]`?'Promise'
- `Set.prototype[Symbol.toStringTag]`?'Set'
- `%TypedArray%.prototype[Symbol.toStringTag]`?'Uint8Array'?
- `WeakMap.prototype[Symbol.toStringTag]`?'WeakMap'
- `WeakSet.prototype[Symbol.toStringTag]`?'WeakSet'
- `%MapIteratorPrototype%[Symbol.toStringTag]`?'Map Iterator'
- `%SetIteratorPrototype%[Symbol.toStringTag]`?'Set Iterator'
- `%StringIteratorPrototype%[Symbol.toStringTag]`?'String Iterator'
- `Symbol.prototype[Symbol.toStringTag]`?'Symbol'
- `Generator.prototype[Symbol.toStringTag]`?'Generator'
- `GeneratorFunction.prototype[Symbol.toStringTag]`?'GeneratorFunction'

**Symbol.unscopables**

???`Symbol.unscopables`??????????????????`with`???????????`with`?????

???`Symbol.unscopables`??????????????????`with`???????????`with`?????

```javascript
Array.prototype[Symbol.unscopables]
// {
//   copyWithin: true,
//   entries: true,
//   fill: true,
//   find: true,
//   findIndex: true,
//   keys: true
// }

Object.keys(Array.prototype[Symbol.unscopables])
// ['copyWithin', 'entries', 'fill', 'find', 'findIndex', 'keys']
```

??????????6??????with?????

```javascript
// ??unscopables?
class MyClass {
  foo() { return 1; }
}

var foo = function () { return 2; };

with (MyClass.prototype) {
  foo(); // 1
}

// ?unscopables?
class MyClass {
  foo() { return 1; }
  get [Symbol.unscopables]() {
    return { foo: true };
  }
}

var foo = function () { return 2; };

with (MyClass.prototype) {
  foo(); // 2
}
```

